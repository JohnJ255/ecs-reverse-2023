# ecs-reverse-2023
remake of jam-reverse-2023 to ecs paradigm with framework donburi

Чего не хватило в donburi:
- нет возможности задать реакцию на добавление компонента, ну и на удаление тоже
- нет возможности выбрать/удалить абсолютно все entity в мире - не хватает filter.All() или просто world.GetEntities()
- addSystem принимает только функцию, иногда удобнее было бы передавать структуру с методом Update (через интерфейс)
- иногда неудобно добавлять компоненты, приходится несколько строк писать для получения entry

Что заметил:
- первый уровень было особо сложно начать... Не понятно - как так нет объявления объектов, есть ТОЛЬКО их свойства!
- в большинстве случаев нет особого смысла в запросах и фильтрах, достаточно описать требования к компонентам в структуре, например
- компоненты и системы свалены в кучу в своих папках, надо разделить
- сложно переписывать предыдущую реализацию на ECS, хотя кажется что будет просто. Так лучше не делать без опыта на реальных проектах
- отладка усложняется, внесение изменений упрощается. Сложно проследить что конкретно происходит с тем или иным Entity в течение его жизни через отладку
- принцип единственной ответственности соблюдается гораздо лучше. ECS прямо способствует разбивать всё на отдельные по функциональности блоки и поменьше их смешивать
- постоянно забываешь добавлять системы в работу. Вот бы автоматизировать этот момент!
- кроме этого, со временем теряешь контроль за жизненным циклом компонента. Например, компонент Collision рождается в system.CollisionSystem, а помирает в system.Physics. То есть все системы, которые хотят регаировать на коллизии, должны располагаться между ними. Но как это понять человеку со стороны? Тут нужно либо чёткое правило, например, кто порождает компонент, тот его и удаляет - гарантия что компонент пройдёт 1 полный круг, либо какое-то ещё документирование.
- со временем бывает трудно понять как что работает. Например, как меняются уровни забывается спустя несколько дней. Приходится немного вникать в код, хотя много времени на данном проекте это не занимает. Впрочем, такое бывало и в прошлом подходе.
- не знал как лучше сделать паузы. Сделал через встройку в каждую систему проверку на наличие компонента паузы. Решение не очень нравится, но другие варианты показались ещё хуже
- не знал как лучше использовать общий код. Например, расчёт координат фаркопа. В итоге оставил просто вынесенными в функции в common, хотя каждая система получается вынуждена пересчитывать его заново по несколько раз за кадр. По идее оптимальнее было бы сохранять в какой-то компонент с координатами, но когда я так сделал, полезли ошибки расчётов и решил обойтись без доп. компонента вместо того, чтобы разбираться в источнике проблемы
- несмотря на то что переписывал старый проект, времени заняло не меньше. Возможно по неопытности или просто устал от проекта и хочется чего-то нового, некоторые доделки вносил через силу. Хотя в целом ECS подход понравился.
- система физики была ущербна изначально, но тут это проявляется гораздо сильнее и легко машинку перекинуть через ограждение. Несмотря на то, что перенёс вроде бы 1 к 1. Не знаю в чём причина, возможно частота обновления отличается или где-то допустил неточность.